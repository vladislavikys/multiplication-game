<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è - –ò–≥—Ä–∞</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function MultiplicationGame() {
          const [gameState, setGameState] = useState('setup');
          const [totalRounds, setTotalRounds] = useState(10);
          const [num1, setNum1] = useState(0);
          const [num2, setNum2] = useState(0);
          const [answer, setAnswer] = useState('');
          const [score, setScore] = useState(0);
          const [currentRound, setCurrentRound] = useState(0);
          const [message, setMessage] = useState('');
          const [streak, setStreak] = useState(0);
          const [bestStreak, setBestStreak] = useState(0);
          const [soundEnabled, setSoundEnabled] = useState(true);
          const [attempts, setAttempts] = useState(2);
          const [lives, setLives] = useState(2);
          const [gameHistory, setGameHistory] = useState([]);
          
          const audioContextRef = useRef(null);

          useEffect(() => {
            try {
              audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
              console.log('Audio not supported');
            }
          }, []);

          const speak = (text) => {
            if (!soundEnabled) return;
            try {
              const utterance = new SpeechSynthesisUtterance(text);
              utterance.lang = 'ru-RU';
              utterance.rate = 0.9;
              utterance.pitch = 1.2;
              utterance.volume = 1;
              window.speechSynthesis.cancel();
              window.speechSynthesis.speak(utterance);
            } catch (e) {
              console.log('Speech not supported');
            }
          };

          const playSound = (frequency, duration, type = 'sine') => {
            if (!soundEnabled || !audioContextRef.current) return;
            try {
              const ctx = audioContextRef.current;
              const oscillator = ctx.createOscillator();
              const gainNode = ctx.createGain();
              oscillator.connect(gainNode);
              gainNode.connect(ctx.destination);
              oscillator.frequency.value = frequency;
              oscillator.type = type;
              gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + duration);
            } catch (e) {
              console.log('Sound error');
            }
          };

          const playCorrectSound = () => {
            playSound(523.25, 0.1);
            setTimeout(() => playSound(659.25, 0.1), 100);
            setTimeout(() => playSound(783.99, 0.2), 200);
          };

          const playWrongSound = () => playSound(200, 0.3, 'sawtooth');
          
          const playStreakSound = () => {
            playSound(880, 0.15);
            setTimeout(() => playSound(1046.5, 0.2), 150);
          };

          const startGame = () => {
            setGameState('playing');
            setScore(0);
            setCurrentRound(0);
            setStreak(0);
            setBestStreak(0);
            setGameHistory([]);
            generateQuestion();
          };

          const generateQuestion = () => {
            const n1 = Math.floor(Math.random() * 10) + 1;
            const n2 = Math.floor(Math.random() * 10) + 1;
            setNum1(n1);
            setNum2(n2);
            setAnswer('');
            setMessage('');
            setAttempts(2);
            setLives(2);
          };

          const showResults = () => {
            setGameState('results');
          };

          const checkAnswer = () => {
            const userAnswer = parseInt(answer);
            const correctAnswer = num1 * num2;
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
              playCorrectSound();
              speak('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü!');
              setScore(score + 1);
              setStreak(streak + 1);
              if (streak + 1 > bestStreak) setBestStreak(streak + 1);
              if ((streak + 1) % 5 === 0) setTimeout(playStreakSound, 300);
              setMessage('üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü!');
              
              const existingWrong = gameHistory.find(h => h.question === `${num1} √ó ${num2}` && !h.isCorrect);
              setGameHistory([...gameHistory.filter(h => !(h.question === `${num1} √ó ${num2}` && !h.isCorrect)), {
                question: `${num1} √ó ${num2}`,
                userAnswer,
                correctAnswer,
                isCorrect: true,
                wrongAnswers: existingWrong?.wrongAnswers || []
              }]);
              
              const nextRound = currentRound + 1;
              setCurrentRound(nextRound);
              if (nextRound >= totalRounds) {
                setTimeout(() => showResults(), 2000);
              } else {
                setTimeout(generateQuestion, 2000);
              }
            } else {
              if (attempts > 0) {
                playWrongSound();
                speak('–ü–æ–¥—É–º–∞–π –µ—â—ë');
                setAttempts(attempts - 1);
                setLives(lives - 1);
                setMessage('ü§î –ü–æ–¥—É–º–∞–π –µ—â—ë');
                
                const existingEntry = gameHistory.find(h => h.question === `${num1} √ó ${num2}` && !h.isCorrect);
                const wrongAnswers = existingEntry?.wrongAnswers ? [...existingEntry.wrongAnswers, userAnswer] : [userAnswer];
                setGameHistory([...gameHistory.filter(h => !(h.question === `${num1} √ó ${num2}` && !h.isCorrect)), {
                  question: `${num1} √ó ${num2}`,
                  userAnswer,
                  correctAnswer,
                  isCorrect: false,
                  wrongAnswers
                }]);
                setAnswer('');
              } else {
                playWrongSound();
                speak(`–ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç ${correctAnswer}`);
                setStreak(0);
                setMessage(`‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswer}`);
                
                const existingEntry = gameHistory.find(h => h.question === `${num1} √ó ${num2}` && !h.isCorrect);
                const wrongAnswers = existingEntry?.wrongAnswers ? [...existingEntry.wrongAnswers, userAnswer] : [userAnswer];
                setGameHistory([...gameHistory.filter(h => !(h.question === `${num1} √ó ${num2}` && !h.isCorrect)), {
                  question: `${num1} √ó ${num2}`,
                  userAnswer,
                  correctAnswer,
                  isCorrect: false,
                  wrongAnswers
                }]);
                
                const nextRound = currentRound + 1;
                setCurrentRound(nextRound);
                if (nextRound >= totalRounds) {
                  setTimeout(() => showResults(), 2500);
                } else {
                  setTimeout(generateQuestion, 2500);
                }
              }
            }
          };

          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && answer !== '') checkAnswer();
          };

          const resetGame = () => {
            setGameState('setup');
            setTotalRounds(10);
          };

          const percentage = totalRounds > 0 ? Math.round((score / totalRounds) * 100) : 0;

          const mathBg = {
            backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='5' y='20' font-size='20' fill='%23e0e7ff' opacity='0.3'%3E+%3C/text%3E%3Ctext x='35' y='45' font-size='20' fill='%23ddd6fe' opacity='0.3'%3E√ó%3C/text%3E%3Ctext x='15' y='50' font-size='18' fill='%23fce7f3' opacity='0.3'%3E=%3C/text%3E%3C/svg%3E")`,
            backgroundSize: '60px 60px'
          };

          if (gameState === 'setup') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-200 via-pink-200 to-blue-200 flex items-center justify-center p-4" style={mathBg}>
                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full border-4 border-purple-400 relative overflow-hidden">
                  <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400"></div>
                  
                  <div className="text-center mb-8">
                    <div className="text-6xl mb-4">üî¢</div>
                    <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-2">
                      –¢–∞–±–ª–∏—Ü–∞ –£–º–Ω–æ–∂–µ–Ω–∏—è
                    </h1>
                    <p className="text-purple-600 font-bold text-lg">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!</p>
                  </div>

                  <div className="mb-6 bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-2xl border-2 border-purple-300">
                    <label className="block text-purple-800 font-bold mb-3 text-center text-lg">
                      üéØ –°–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ö–æ—á–µ—à—å —Ä–µ—à–∏—Ç—å?
                    </label>
                    <div className="text-center mb-4">
                      <span className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                        {totalRounds}
                      </span>
                    </div>
                    <input
                      type="range"
                      value={totalRounds}
                      onChange={(e) => setTotalRounds(parseInt(e.target.value))}
                      min="5"
                      max="50"
                      step="5"
                      className="w-full h-4 rounded-full appearance-none cursor-pointer"
                      style={{
                        background: `linear-gradient(to right, #a855f7 0%, #ec4899 ${(totalRounds - 5) / 45 * 100}%, #e9d5ff ${(totalRounds - 5) / 45 * 100}%, #fce7f3 100%)`
                      }}
                    />
                    <div className="flex justify-between text-sm text-purple-600 mt-2 font-semibold">
                      <span>5</span>
                      <span>25</span>
                      <span>50</span>
                    </div>
                    <p className="text-sm text-purple-600 mt-3 text-center font-semibold">
                      ‚≠ê –ü–µ—Ä–µ—Ç–∞—â–∏ –ø–æ–ª–∑—É–Ω–æ–∫
                    </p>
                  </div>

                  <button
                    onClick={startGame}
                    className="w-full bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 text-white text-2xl font-black py-5 rounded-2xl hover:from-purple-600 hover:via-pink-600 hover:to-purple-600 transition-all transform hover:scale-105 flex items-center justify-center gap-3 shadow-lg"
                  >
                    ‚ñ∂ –ü–û–ï–•–ê–õ–ò!
                  </button>
                  
                  <div className="mt-4 flex justify-center gap-4 text-4xl opacity-50">
                    <span>√∑</span>
                    <span>+</span>
                    <span>‚àí</span>
                    <span>√ó</span>
                    <span>=</span>
                  </div>
                </div>
              </div>
            );
          }

          if (gameState === 'results') {
            const grade = percentage >= 90 ? 'üèÜ' : percentage >= 70 ? '‚≠ê' : percentage >= 50 ? 'üëç' : 'üí™';
            
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-200 via-pink-200 to-blue-200 flex items-center justify-center p-4" style={mathBg}>
                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full border-4 border-purple-400 relative overflow-hidden">
                  <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400"></div>
                  
                  <div className="text-center mb-6">
                    <div className="text-8xl mb-4">{grade}</div>
                    <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-2">
                      –ò–≥—Ä–∞ –ó–∞–≤–µ—Ä—à–µ–Ω–∞!
                    </h1>
                    <p className="text-2xl font-bold text-purple-600">
                      {percentage >= 90 ? '–û—Ç–ª–∏—á–Ω–æ!' : percentage >= 70 ? '–•–æ—Ä–æ—à–æ!' : percentage >= 50 ? '–ù–µ–ø–ª–æ—Ö–æ!' : '–ü—Ä–æ–¥–æ–ª–∂–∞–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è!'}
                    </p>
                  </div>

                  <div className="grid grid-cols-3 gap-4 mb-6">
                    <div className="bg-gradient-to-br from-green-400 to-emerald-500 rounded-2xl p-4 text-center shadow-lg">
                      <div className="text-4xl font-black text-white">{score}</div>
                      <div className="text-sm font-bold text-white">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                    </div>
                    <div className="bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl p-4 text-center shadow-lg">
                      <div className="text-4xl font-black text-white">{totalRounds}</div>
                      <div className="text-sm font-bold text-white">üìù –í—Å–µ–≥–æ</div>
                    </div>
                    <div className="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl p-4 text-center shadow-lg">
                      <div className="text-4xl font-black text-white">{percentage}%</div>
                      <div className="text-sm font-bold text-white">üìä –ü—Ä–æ—Ü–µ–Ω—Ç</div>
                    </div>
                  </div>

                  <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-4 mb-6 border-2 border-purple-300">
                    <div className="text-center text-xl font-black text-purple-700">
                      ‚≠ê –õ—É—á—à–∞—è —Å–µ—Ä–∏—è: {bestStreak} –ø–æ–¥—Ä—è–¥! ‚≠ê
                    </div>
                  </div>

                  <div className="mb-6 max-h-80 overflow-y-auto bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-4 border-2 border-purple-300">
                    <h3 className="font-black text-purple-700 mb-3 text-center text-xl">
                      ‚ú® –¢–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: ‚ú®
                    </h3>
                    <div className="space-y-2">
                      {gameHistory.map((item, index) => (
                        <div key={index} className={`flex justify-between items-center py-3 px-4 rounded-xl shadow-md font-bold text-lg ${
                          item.isCorrect ? 'bg-gradient-to-r from-green-100 to-emerald-100 border-2 border-green-400' : 'bg-gradient-to-r from-red-100 to-rose-100 border-2 border-red-400'
                        }`}>
                          <span className="text-purple-900">
                            {index + 1}. {item.question} = {item.correctAnswer}
                          </span>
                          <div className="flex items-center gap-2">
                            {!item.isCorrect && item.wrongAnswers && item.wrongAnswers.length > 0 && (
                              <span className="text-sm text-red-600 bg-red-50 px-2 py-1 rounded border border-red-300">
                                –ü–æ–ø—ã—Ç–∫–∏: {item.wrongAnswers.join(', ')}
                              </span>
                            )}
                            <span className={`text-2xl ${item.isCorrect ? 'text-green-600' : 'text-red-600'}`}>
                              {item.isCorrect ? '‚úì' : '‚úó'}
                            </span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <button
                    onClick={resetGame}
                    className="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 text-white font-black py-5 text-xl rounded-2xl hover:from-purple-600 hover:via-pink-600 hover:to-purple-600 transition-all shadow-lg"
                  >
                    üîÑ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê!
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-200 via-pink-200 to-blue-200 flex items-center justify-center p-4" style={mathBg}>
              <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full border-4 border-purple-400 relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400"></div>
                
                <div className="text-center mb-6">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex-1"></div>
                    <h1 className="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 flex-1">
                      üî¢ –¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è üî¢
                    </h1>
                    <button
                      onClick={() => setSoundEnabled(!soundEnabled)}
                      className="flex-1 flex justify-end text-3xl"
                      style={{background: 'none', border: 'none', cursor: 'pointer'}}
                    >
                      {soundEnabled ? 'üîä' : 'üîá'}
                    </button>
                  </div>
                  <p className="text-purple-600 font-bold text-lg">–ü—Ä–∏–º–µ—Ä {currentRound + 1} –∏–∑ {totalRounds}</p>
                </div>

                <div className="grid grid-cols-3 gap-3 mb-6">
                  <div className="bg-gradient-to-br from-green-400 to-emerald-500 rounded-2xl p-3 text-center shadow-lg">
                    <div className="text-2xl font-black text-white">{score}</div>
                    <div className="text-xs font-bold text-white">‚úì –í–µ—Ä–Ω–æ</div>
                  </div>
                  <div className="bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl p-3 text-center shadow-lg">
                    <div className="text-2xl font-black text-white">{currentRound}</div>
                    <div className="text-xs font-bold text-white">üìù –†–µ—à–µ–Ω–æ</div>
                  </div>
                  <div className="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl p-3 text-center shadow-lg">
                    <div className="text-2xl font-black text-white">{percentage}%</div>
                    <div className="text-xs font-bold text-white">üìä</div>
                  </div>
                </div>

                <div className="flex items-center justify-center gap-2 mb-6 bg-gradient-to-r from-yellow-100 to-orange-100 p-3 rounded-2xl border-2 border-yellow-400 shadow-inner">
                  <span className="text-2xl">‚≠ê</span>
                  <span className="text-lg font-black text-orange-700">
                    –°–µ—Ä–∏—è: {streak} üî•
                  </span>
                  {bestStreak > 0 && (
                    <span className="text-sm font-bold text-orange-600 ml-2">
                      (–º–∞–∫—Å: {bestStreak})
                    </span>
                  )}
                </div>

                <div className="bg-gradient-to-br from-purple-100 via-pink-100 to-blue-100 rounded-3xl p-6 mb-6 border-3 border-purple-300 shadow-xl">
                  <div className="flex justify-center gap-3 mb-4">
                    {[...Array(2)].map((_, i) => (
                      <span key={i} className="text-4xl">
                        {lives > i ? '‚ù§Ô∏è' : 'ü§ç'}
                      </span>
                    ))}
                  </div>
                  
                  <div className="text-center mb-6 bg-white p-4 rounded-2xl border-3 border-purple-300 shadow-inner">
                    <div className="flex items-center justify-center gap-3 flex-wrap">
                      <span className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                        {num1}
                      </span>
                      <span className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                        √ó
                      </span>
                      <span className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                        {num2}
                      </span>
                      <span className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                        =
                      </span>
                      <input
                        type="text"
                        inputMode="numeric"
                        pattern="[0-9]*"
                        value={answer}
                        onChange={(e) => {
                          const value = e.target.value.replace(/[^0-9]/g, '');
                          setAnswer(value);
                        }}
                        onKeyPress={handleKeyPress}
                        className="w-24 text-5xl text-center border-4 border-purple-400 rounded-xl p-2 focus:outline-none focus:border-pink-500 font-black text-purple-700 bg-yellow-50 shadow-lg"
                        placeholder="?"
                        autoFocus
                      />
                    </div>
                  </div>

                  <button
                    onClick={checkAnswer}
                    disabled={answer === ''}
                    className="w-full bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 text-white text-xl font-black py-4 rounded-2xl hover:from-purple-600 hover:via-pink-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105 shadow-lg"
                  >
                    –ü–†–û–í–ï–†–ò–¢–¨ ‚ú®
                  </button>
                </div>

                {message && (
                  <div className={`text-center text-xl font-black mb-4 p-4 rounded-2xl border-3 shadow-lg ${
                    message.includes('–ü—Ä–∞–≤–∏–ª—å–Ω–æ') 
                      ? 'bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 border-green-400' 
                      : message.includes('–ü–æ–¥—É–º–∞–π')
                      ? 'bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-700 border-yellow-400'
                      : 'bg-gradient-to-r from-red-100 to-rose-100 text-red-700 border-red-400'
                  }`}>
                    {message}
                  </div>
                )}

                {score >= 5 && currentRound < totalRounds && (
                  <div className="mt-6 text-center bg-gradient-to-r from-yellow-100 to-orange-100 p-4 rounded-2xl border-2 border-yellow-400 shadow-lg">
                    <div className="text-4xl mb-2">üèÜ</div>
                    <div className="text-yellow-800 font-black text-lg">
                      ‚≠ê –°—É–ø–µ—Ä! –¢—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è! ‚≠ê
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(MultiplicationGame));
    </script>
</body>
</html>
